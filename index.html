<script type="module">
    import 'https://cdn.interactjs.io/v1.9.20/auto-start/index.js'
    import 'https://cdn.interactjs.io/v1.9.20/actions/drag/index.js'
    import 'https://cdn.interactjs.io/v1.9.20/actions/resize/index.js'
    import 'https://cdn.interactjs.io/v1.9.20/modifiers/index.js'
    import 'https://cdn.interactjs.io/v1.9.20/dev-tools/index.js'
    import interact from 'https://cdn.interactjs.io/v1.9.20/interactjs/index.js'
    // https://interactjs.io/docs/snapping/

    const die = [
        ['I', 'I', 'O', 'Y', 'N', 'N'],
        ['R', 'R', 'D', 'L', 'G', 'G'],
        ['B', 'L', 'M', 'M', 'L', 'Y'],
        ['S', 'B', 'K', 'X', 'Z', 'N'],
        ['A', 'I', 'U', 'E', 'U', 'O'],
        ['P', 'F', 'G', 'K', 'P', 'V'],
        ['E', 'A', 'E', 'O', 'A', 'O'],
        ['H', 'H', 'P', 'T', 'W', 'T'],
        ['D', 'F', 'R', 'L', 'W', 'L'],
        ['R', 'N', 'R', 'H', 'N', 'H'],
        ['C', 'M', 'T', 'S', 'T', 'C'],
        ['D', 'B', 'J', 'C', 'C', 'T']
    ];

    const coords = [];

    initLetters();
    interact('.letter')
    .draggable({
        modifiers: [
            interact.modifiers.snap({
                targets: [
                    interact.snappers.grid({ x: 75, y: 75 })
                ],
                offset: 'parent',
                relativePoints: [ { x: 0, y: 0 } ] //snap to top left of element
            }),
            interact.modifiers.restrict({
                restriction: 'parent',
                elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
            })
        ]
    })
    .on('dragmove', function (event) {
        const index = event.target.getAttribute('id');
        coords[index].x += event.dx;
        coords[index].y += event.dy;

        event.target.style.transform = 'translate(' + coords[index].x + 'px, ' + coords[index].y + 'px)';

        checkForOverlappingTiles();

        updateBoardValidity();
    });

    function checkForOverlappingTiles() {
        for (let i = document.getElementsByClassName('letter').length - 1; i > -1; i--) {
            const firstIndexOfCoords = coords.findIndex(coord => coord.x === coords[i].x && coord.y === coords[i].y);

            const letterElement = document.getElementById(i);
            firstIndexOfCoords === i ? letterElement.classList.remove('overlapping') : letterElement.classList.add('overlapping');
        }
    }

    function updateBoardValidity() {
        const validityElement = document.getElementById('validity');
        const boardIsValid = isValidBoard();
        validityElement.innerText = boardIsValid ? 'Valid Board' : 'Invalid Board';
        validityElement.style.color = boardIsValid ? 'green' : 'red';
    }

    function initLetters() {    
        var letters = document.getElementsByClassName('letter');
        for(let letter of letters) {
            const index = letter.getAttribute('id');
            coords[index] = { x: 0, y: 75 * index };
            letter.innerText = die[index][randomIntFrom0To5()];
            letter.style.transform = 'translate(' + coords[index].x + 'px, ' + coords[index].y + 'px)';
        }
    }
    function randomIntFrom0To5() {
        return Math.floor(Math.random() * 6);
    }
    function isValidBoard() {
        const tilesConnected = [];
        const tilesToProcess = ['0'];

        while (tilesToProcess.length > 0) {
            const nextTile = tilesToProcess.pop();
            if (tilesConnected.indexOf(nextTile) === -1) {
                tilesConnected.push(nextTile);

                const neighborTop = getNeighbor(coords[nextTile].x, coords[nextTile].y - 75);
                const neighborBot = getNeighbor(coords[nextTile].x, coords[nextTile].y + 75);
                const neighborLeft = getNeighbor(coords[nextTile].x - 75, coords[nextTile].y);
                const neighborRight = getNeighbor(coords[nextTile].x + 75, coords[nextTile].y);

                if (neighborTop !== undefined && tilesConnected.indexOf(neighborTop) === -1 && tilesToProcess.indexOf(neighborTop) === -1) {
                    tilesToProcess.push(neighborTop);
                } 
                if (neighborBot !== undefined && tilesConnected.indexOf(neighborBot) === -1 && tilesToProcess.indexOf(neighborBot) === -1) {
                    tilesToProcess.push(neighborBot);
                } 
                if (neighborLeft !== undefined && tilesConnected.indexOf(neighborLeft) === -1 && tilesToProcess.indexOf(neighborLeft) === -1) {
                    tilesToProcess.push(neighborLeft);
                } 
                if (neighborRight !== undefined && tilesConnected.indexOf(neighborRight) === -1 && tilesToProcess.indexOf(neighborRight) === -1) {
                    tilesToProcess.push(neighborRight);
                } 
            }
        }

        return tilesConnected.length === document.getElementsByClassName('letter').length;
    }

    function getNeighbor(x, y) {
        var letters = document.getElementsByClassName('letter');
        for(let letter of letters) {
            const index = letter.getAttribute('id');
            if (coords[index].x === x && coords[index].y === y) {
                return index;
            }
        }
    }
</script>
<style>
    .letter {
        width: 75px;
        height: 75px;
        border-radius: 4px;
        background-color: cadetblue;
        color: silver;
        font-size: 4em;
        touch-action: none;
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .overlapping {
        color: red;
    }

    #board {
        display: block;
        background-color: silver;
        width: 900px;
        height: 900px;
        margin: auto;
    }

    #page {
        text-align: center;
        margin: auto;
    }
</style>

<div id="page"> 
    <h1>Hello!</h1>

    <span id="board">
        <span class="letter" id="0"></span>
        <span class="letter" id="1"></span>
        <span class="letter" id="2"></span>
        <span class="letter" id="3"></span>
        <span class="letter" id="4"></span>
        <span class="letter" id="5"></span>
        <span class="letter" id="6"></span>
        <span class="letter" id="7"></span>
        <span class="letter" id="8"></span>
        <span class="letter" id="9"></span>
        <span class="letter" id="10"></span>
        <span class="letter" id="11"></span>
    </span>
    <div>
        <h2 id="validity">Validity coming soon...</h2>
    </div>
    <h2>Word List</h2>
    <p>coming sooner...</p>
</div>